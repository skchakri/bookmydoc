<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Back Button -->
    <div class="mb-6">
      <%= link_to patients_dashboard_path, class: "inline-flex items-center text-sm text-gray-600 hover:text-gray-900" do %>
        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
        Back to Dashboard
      <% end %>
    </div>

    <!-- Symptom Report Card -->
    <div class="bg-white rounded-lg shadow-lg overflow-hidden mb-6">
      <div class="bg-gradient-to-r from-primary-600 to-primary-700 px-6 py-6">
        <div class="flex items-start justify-between">
          <div>
            <h1 class="text-2xl font-bold text-white mb-2">Symptom Analysis Report</h1>
            <p class="text-primary-100 text-sm">Submitted on <%= @symptom_report.created_at.strftime("%B %d, %Y at %I:%M %p") %></p>
          </div>
          <div class="flex items-center gap-3">
            <!-- Urgency Badge -->
            <% if @symptom_report.ai_urgency_level.present? %>
              <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-bold <%= case @symptom_report.ai_urgency_level
                when 'EMERGENCY' then 'bg-red-100 text-red-800 border-2 border-red-300'
                when 'URGENT' then 'bg-orange-100 text-orange-800 border-2 border-orange-300'
                when 'MODERATE' then 'bg-yellow-100 text-yellow-800 border-2 border-yellow-300'
                else 'bg-green-100 text-green-800 border-2 border-green-300'
                end %>">
                <%= @symptom_report.ai_urgency_level %>
              </span>
            <% end %>
            <div class="bg-white bg-opacity-20 rounded-lg px-4 py-2">
              <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <div class="p-6">
        <!-- Your Symptoms -->
        <div class="mb-6">
          <h2 class="text-lg font-semibold text-gray-900 mb-3 flex items-center">
            <svg class="w-5 h-5 mr-2 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            Your Symptoms
          </h2>
          <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
            <p class="text-gray-900 whitespace-pre-wrap leading-relaxed"><%= @symptom_report.free_text_description %></p>
          </div>
        </div>

        <!-- Additional Context Information -->
        <% if @symptom_report.symptom_duration.present? || @symptom_report.medications_taken.present? || @symptom_report.previous_tests.present? || @symptom_report.referred_by.present? %>
          <div class="mb-6 bg-purple-50 border border-purple-200 rounded-lg p-5">
            <h3 class="text-base font-semibold text-purple-900 mb-3 flex items-center">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
              </svg>
              Additional Information
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <% if @symptom_report.symptom_duration.present? %>
                <div>
                  <p class="text-xs font-medium text-purple-700 mb-1">Duration</p>
                  <p class="text-sm text-purple-900"><%= @symptom_report.symptom_duration.humanize.gsub('_', ' ') %></p>
                </div>
              <% end %>
              <% if @symptom_report.referred_by.present? %>
                <div>
                  <p class="text-xs font-medium text-purple-700 mb-1">Referred By</p>
                  <p class="text-sm text-purple-900"><%= @symptom_report.referred_by %></p>
                </div>
              <% end %>
              <% if @symptom_report.medications_taken.present? %>
                <div class="md:col-span-2">
                  <p class="text-xs font-medium text-purple-700 mb-1">Medications Taken</p>
                  <p class="text-sm text-purple-900 whitespace-pre-wrap"><%= @symptom_report.medications_taken %></p>
                </div>
              <% end %>
              <% if @symptom_report.previous_tests.present? %>
                <div class="md:col-span-2">
                  <p class="text-xs font-medium text-purple-700 mb-1">Previous Medical Tests</p>
                  <p class="text-sm text-purple-900 whitespace-pre-wrap"><%= @symptom_report.previous_tests %></p>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>

        <!-- AI Predicted Condition -->
        <% if @symptom_report.ai_predicted_condition.present? %>
          <div class="mb-6 bg-blue-50 border-l-4 border-blue-500 rounded-r-lg p-5">
            <div class="flex">
              <div class="flex-shrink-0">
                <svg class="h-6 w-6 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                </svg>
              </div>
              <div class="ml-3 flex-1">
                <h3 class="text-base font-semibold text-blue-900 mb-2">AI Predicted Condition</h3>
                <p class="text-sm text-blue-800 leading-relaxed"><%= @symptom_report.ai_predicted_condition %></p>
              </div>
            </div>
          </div>
        <% end %>

        <!-- Symptom Details & Explanation -->
        <% if @symptom_report.ai_symptom_details.present? %>
          <div class="mb-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-3 flex items-center">
              <svg class="w-5 h-5 mr-2 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              Understanding Your Symptoms
            </h2>
            <div class="bg-purple-50 rounded-lg p-5 border border-purple-200">
              <p class="text-gray-800 leading-relaxed"><%= @symptom_report.ai_symptom_details %></p>
            </div>
          </div>
        <% end %>

        <!-- Basic Care & Medication Recommendations -->
        <% if @symptom_report.parsed_basic_care_recommendations.any? %>
          <div class="mb-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-3 flex items-center">
              <svg class="w-5 h-5 mr-2 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
              </svg>
              Basic Care & Medication Recommendations
            </h2>
            <div class="bg-green-50 rounded-lg border border-green-200">
              <div class="p-5">
                <div class="space-y-3">
                  <% @symptom_report.parsed_basic_care_recommendations.each_with_index do |recommendation, index| %>
                    <div class="flex items-start">
                      <div class="flex-shrink-0 mt-1">
                        <span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-green-200 text-green-800 text-xs font-bold">
                          <%= index + 1 %>
                        </span>
                      </div>
                      <p class="ml-3 text-sm text-gray-800 leading-relaxed"><%= recommendation %></p>
                    </div>
                  <% end %>
                </div>
              </div>
              <div class="bg-yellow-50 border-t border-yellow-200 px-5 py-3">
                <p class="text-xs text-yellow-800 flex items-start">
                  <svg class="w-4 h-4 mr-2 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                  </svg>
                  <span><strong>Important:</strong> These are general recommendations. Always consult with a healthcare professional before starting any medication. Follow dosage instructions on packaging.</span>
                </p>
              </div>
            </div>
          </div>
        <% end %>

        <!-- Recommended Specializations -->
        <% if @symptom_report.ai_recommended_specializations.present? %>
          <div class="mb-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-3 flex items-center">
              <svg class="w-5 h-5 mr-2 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
              </svg>
              Recommended Medical Specialists
            </h2>
            <div class="flex flex-wrap gap-3">
              <% @symptom_report.ai_recommended_specializations.each do |specialization| %>
                <span class="inline-flex items-center px-4 py-2 rounded-lg text-sm font-medium bg-primary-100 text-primary-800 border border-primary-200">
                  <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  <%= specialization %>
                </span>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Recommended Doctors -->
    <% if @recommended_doctors.any? %>
      <div class="bg-white rounded-lg shadow-lg overflow-hidden">
        <div class="bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-5 border-b border-gray-200">
          <div class="flex items-center justify-between">
            <div>
              <h2 class="text-xl font-semibold text-gray-900 flex items-center">
                <svg class="w-6 h-6 mr-2 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Recommended Doctors Near You
              </h2>
              <p class="text-sm text-gray-600 mt-1">Based on your symptoms and recommended specializations</p>
            </div>
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-primary-100 text-primary-800">
              <%= pluralize(@recommended_doctors.count, 'doctor') %> found
            </span>
          </div>
        </div>

        <div class="divide-y divide-gray-200">
          <% @recommended_doctors.each do |doctor| %>
            <div class="p-6 hover:bg-gray-50 transition-colors">
              <div class="flex items-start gap-4">
                <!-- Doctor Avatar -->
                <div class="flex-shrink-0">
                  <% if doctor.avatar.attached? %>
                    <%= image_tag doctor.avatar, class: "w-20 h-20 rounded-full object-cover border-2 border-primary-200" %>
                  <% else %>
                    <div class="w-20 h-20 bg-primary-100 rounded-full flex items-center justify-center border-2 border-primary-200">
                      <span class="text-2xl font-bold text-primary-700"><%= doctor.full_name[0] %></span>
                    </div>
                  <% end %>
                </div>

                <!-- Doctor Info -->
                <div class="flex-1 min-w-0">
                  <div class="flex items-start justify-between mb-2">
                    <div>
                      <h3 class="text-lg font-semibold text-gray-900">Dr. <%= doctor.full_name %></h3>
                      <span class="inline-flex items-center px-3 py-1 mt-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                        <%= doctor.specialization %>
                      </span>
                    </div>
                    <% if doctor.is_verified? %>
                      <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                        <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                        Verified
                      </span>
                    <% end %>
                  </div>

                  <div class="grid grid-cols-2 gap-4 mt-3">
                    <div class="flex items-center text-sm text-gray-600">
                      <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                      </svg>
                      <%= doctor.years_of_experience %> years experience
                    </div>
                    <div class="flex items-center text-sm text-gray-600">
                      <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                      </svg>
                      <%= doctor.address.present? ? doctor.address.split(',').first : 'Location not specified' %>
                    </div>
                  </div>

                  <div class="mt-4 flex items-center justify-between">
                    <div>
                      <p class="text-xs text-gray-500">Consultation Fee</p>
                      <p class="text-lg font-bold text-primary-600">â‚¹<%= number_with_delimiter(doctor.consultation_fee_initial) %></p>
                    </div>
                    <%= link_to "View Profile & Book Appointment", doctor_path(doctor), class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors" %>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% else %>
      <div class="bg-white rounded-lg shadow-lg p-8 text-center">
        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
        </svg>
        <h3 class="mt-2 text-sm font-medium text-gray-900">No doctors found</h3>
        <p class="mt-1 text-sm text-gray-500">No verified doctors found matching the recommended specializations in your area.</p>
        <div class="mt-6">
          <%= link_to "Browse All Doctors", doctors_path, class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500" %>
        </div>
      </div>
    <% end %>

    <!-- Medical Disclaimer -->
    <div class="mt-8 bg-red-50 border-l-4 border-red-400 p-4 rounded-r-lg">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
          </svg>
        </div>
        <div class="ml-3">
          <p class="text-sm text-red-800">
            <strong class="font-semibold">Important Medical Disclaimer:</strong> This AI analysis is for informational purposes only and does not constitute medical advice, diagnosis, or treatment. Always seek the advice of your physician or other qualified healthcare provider with any questions you may have regarding a medical condition. Never disregard professional medical advice or delay in seeking it because of something you have read here. If you think you may have a medical emergency, call your doctor or emergency services immediately.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
